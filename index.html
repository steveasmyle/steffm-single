<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=9">
      <meta property="og:image" content="images/social480.jpg">
      <meta property="og:image:width" content="480">
      <meta property="og:image:height" content="252">
      <meta property="og:image" content="images/socialFull.jpg">
      <meta property="og:image:width" content="1200">
      <meta property="og:image:height" content="630">
      <meta name="description" content="A demo of how far you can push creating graphical elements built with nothing more than HTML and CSS. The only images are for textures, not shape or design.">
      <!-- <link rel="shortcut icon" href="favicon.ico"> -->
      <!--[if !IE]>-->
      <link rel="stylesheet" href="calc.screen.css" media="screen">
      <!-- <link rel="icon" href="vanilla.svg" type="image/svg+xml"> -->
      <!-- <link rel="apple-touch-icon" href="apple-touch-icon.png"> -->
      <!-- <link rel="mask-icon" href="vanilla.mask.svg" color="#EC8"> -->
      <!--<![endif]-->
      <title>Stef.FM</title>
   </head>
   <body>
      <div id="fauxBody">
         <h1>Stef.FM</h1>
         <!-- #fauxBody -->
         <section class="player">
            <div class="power">POWER</div>
            <h2>STEF&nbsp;.&nbsp;FM<span>9000</span></h2>
            <output>
               <var id="display1"></var>
                           
               <span></span>
            </output>
            <ul class="flags">
               <li id="flagSkipBackward" title="Skip backward" data-text="⏮" class="smallGlyph"></li>
               <li id="flagReverse" title="Reverse" data-text="⏴⏴" class="smallGlyph"></li>
               <li id="flagStop" title="Stop" data-text="⏹" class="smallGlyph"></li>
               <li id="flagPause" title="Pause" data-text="⏸" class="smallGlyph"></li>
               <li id="flagPlay" title="Play" data-text="⏵" class="smallGlyph"></li>
               <li id="flagFastForward" title="Fast forward" data-text="⏵⏵" class="smallGlyph"></li>
               <li id="flagSkipForward" title="Skip forward" data-text="⏭" class="smallGlyph"></li>
               <li id="flagError" title="An error has occurred" data-text="ERR"></li>
            </ul>
            <fieldset>
               <button id="up" class="blue" value="Up">
                  <span>↑</span>
               </button>
               <button id="enter" class="brown tall" value="Enter">
                  <span>↵</span>
               </button>
               <button id="down" class="blue" value="Down">
                  <span>↓</span>
               </button>
            </fieldset>
            <fieldset>
               <button id="stop" class="action red" value="Stop">
                  <span>⏹</span>
               </button>
               <button id="play" class="action orange index wide" value="Play">
                  <span>⏵</span>
               </button>
               <button id="pause" class="grey" value="Pause">
                  <span>⏸</span>
               </button>
            </fieldset>
            <fieldset>
               <button id="skipBackward" class="lightGrey" value="Skip backward">
                  <span>⏮</span>
               </button>
               <button id="rewind" class="lightGrey" value="Rewind">
                  <span>⏴⏴</span>
               </button>
               <button id="fastForward" class="lightGrey" value="Fast forward">
                  <span>⏵⏵</span>
               </button>
               <button id="skipForward" class="lightGrey" value="Skip forward">
                  <span>⏭</span>
               </button>
            </fieldset>
            <iframe class="mixcloud" id="mixcloudWidget" width="100%" height="60" src="https://www.mixcloud.com/widget/iframe/?hide_cover=1&mini=1&hide_artwork=1&autoplay=1&feed=%2Frymixxx%2Fmy-pair-of-shoes-volume-89%2F" frameborder="0" allow="autoplay"></iframe>
         </section>
      </div>
      <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
      <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
      <script src="https://widget.mixcloud.com/media/js/widgetApi.js" type="text/javascript"></script>
      <script>

// TICKER
var scrollers = {};

function startScroller(id, text, displayLength, tickDelay, pauseDelay) {
    var str = text.replace(/ /g, "!");
    str = str.padStart(displayLength + str.length, "!");

    var display = document.getElementById(id);
    var startIndex = 0;

    if (scrollers[id]) {
        clearInterval(scrollers[id]);
    }

    scrollers[id] = setInterval(function() {
        var substring = str.substring(startIndex, startIndex + displayLength);
        display.nextSibling.textContent = substring;
        startIndex++;

        if (startIndex > str.length) {
            startIndex = 0;
            clearInterval(scrollers[id]);
            setTimeout(function() {
                startScroller(id, text, displayLength, tickDelay, pauseDelay);
            }, pauseDelay);
        }
    }, tickDelay);
}

function stopScrollers() {
    for (var id in scrollers) {
        clearInterval(scrollers[id]);
    }
    scrollers = {};
}

// Start scrollers
startScroller("display1", "My Pair of Shoes - Volume 89", 12, 250, 500);
// startScroller("display2", "Artist Name", 12, 300, 1000);

// To stop all scrollers, call stopScrollers():
// stopScrollers();


// PERSPECTIVE SHIFT
function updatePerspective(bodyMin, bodyMax, fauxBodyMin, fauxBodyMax) {
    var bodyRange = bodyMax - bodyMin;
    var fauxBodyRange = fauxBodyMax - fauxBodyMin;

    document.addEventListener('mousemove', function(event) {
        var mouseY = event.clientY;
        var viewportHeight = window.innerHeight;
        var proportion = mouseY / viewportHeight;
        var bodyPerspective = (bodyRange * proportion) + bodyMin;
        var fauxBodyPerspective = (fauxBodyRange * proportion) + fauxBodyMin;
        document.body.style.perspective = `${bodyPerspective}rem`;
        document.getElementById('fauxBody').style.perspective = `${fauxBodyPerspective}rem`;
    });
}

updatePerspective(25, 30, 15, 45);




// MIXCLOUD
const widget = Mixcloud.PlayerWidget(document.getElementById("mixcloudWidget"));

let mix = {
   "mixcloudKey": "/rymixxx/my-pair-of-shoes-volume-89/",
   "iframeUrl": "",
   "status": "paused"   
};

const config = {
   "volumeIncrement": 0.05,
   "keyHoldRepeatInterval": 100,
   "keyHoldInitialDelay": 500,
   "iframeUrlPrefix": "https://www.mixcloud.com/widget/iframe/?hide_cover=1&mini=1&hide_artwork=1&autoplay=1&feed="
};

let timeoutId, intervalId;

widget.ready.then(function() {
   console.log("Mixcloud widget ready");

   const upButton = document.getElementById('up');
   const downButton = document.getElementById('down');

   upButton.addEventListener('mousedown', function() {
      volumeUp();
      timeoutId = setTimeout(function() {
      intervalId = setInterval(volumeUp, config.keyHoldRepeatInterval);
      }, config.keyHoldInitialDelay);
   });

   downButton.addEventListener('mousedown', function() {
      volumeDown();
      timeoutId = setTimeout(function() {
      intervalId = setInterval(volumeDown, config.keyHoldRepeatInterval);
      }, config.keyHoldInitialDelay);
   });
   
   upButton.addEventListener('mouseup', stopChangingVolume);
   downButton.addEventListener('mouseup', stopChangingVolume);
   
   function stopChangingVolume() {
      clearTimeout(timeoutId);
      clearInterval(intervalId);
   }
   
   document.getElementById('enter').addEventListener('click', enter);
   document.getElementById('stop').addEventListener('click', stop);
   document.getElementById('play').addEventListener('click', play);
   document.getElementById('pause').addEventListener('click', pause);
   document.getElementById('skipBackward').addEventListener('click', skipBackward);
   document.getElementById('rewind').addEventListener('click', rewind);
   document.getElementById('fastForward').addEventListener('click', fastForward);
   document.getElementById('skipForward').addEventListener('click', skipForward);

   const flagSkipBackward = document.getElementById('skipBackward');
   const flagReverse = document.getElementById('flagReverse');
   const flagStop = document.getElementById('flagStop');
   const flagPause = document.getElementById('flagPause');
   const flagPlay = document.getElementById('flagPlay');
   const flagFastForward = document.getElementById('flagFastForward');
   const flagSkipForward = document.getElementById('flagSkipForward');
   const flagError = document.getElementById('flagError');
  
   widget.events.pause.on(pauseListener);
   widget.events.play.on(playListener);

   function pauseListener() {
      flagPlay.innerHTML = "";
      flagPause.innerHTML = "⏸";
   }

   function playListener() {
      flagPause.innerHTML = "";
      flagPlay.innerHTML = "⏵";
   }

   function volumeUp() {
      console.log("volumeUp");
      widget.getVolume().then(volume => {
         if (volume + config.volumeIncrement <= 1) {
            widget.setVolume(volume + config.volumeIncrement);
         } else {
            widget.setVolume(1);
         }
      });
   }
   
   function volumeDown() {
      console.log("volumeDown");
      widget.getVolume().then(volume => {
         if (volume - config.volumeIncrement >= 0) {
            widget.setVolume(volume - config.volumeIncrement);
         } else {
            widget.setVolume(0);
         }
      });
   }

   function loadNewMix(mixcloudKey) {
      console.log("loadNewMix", mixcloudKey);
      mix.mixcloudKey = mixcloudKey;
      mix.iframeUrl = config.iframeUrlPrefix + encodeURIComponent(mixcloudKey);

      widget.pause().then(function() {
         console.log("pause");
         widget.load(mixcloudKey, true).then(function() {
            console.log("load");
            widget.play();
         });
      });
   }

   function enter() {
   }

   function stop() {
   }

   function play() {
      widget.play();
   }

   function pause() {
      widget.pause();
   }

   function skipBackward() {
      loadNewMix("/rymixxx/my-pair-of-shoes-volume-87/");
   }

   function rewind() {
   }

   function fastForward() {
   }

   function skipForward() {
      loadNewMix("/rymixxx/my-pair-of-shoes-volume-88/");
   }

});

     </script>
   </body>
</html>